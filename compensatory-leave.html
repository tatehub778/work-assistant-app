<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£ä¼‘ç”³è«‹</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="container">
        <nav class="nav-bar">
            <a href="../index.html">
                <span class="back-arrow">â†</span>
                æˆ»ã‚‹
            </a>
        </nav>

        <div class="form-container">
            <h1 class="page-title">ğŸ“… ä»£ä¼‘ç”³è«‹</h1>

            <form id="compensatoryLeaveForm">
                <div class="form-group">
                    <label for="leaveDate">ä»£ä¼‘å–å¾—å¸Œæœ›æ—¥</label>
                    <input type="date" id="leaveDate" required>
                </div>

                <div class="form-group">
                    <label for="workDate">å…ƒã®å‡ºå‹¤æ—¥ï¼ˆä¼‘æ—¥å‡ºå‹¤æ—¥ï¼‰</label>
                    <input type="date" id="workDate" required>
                </div>

                <div class="form-group">
                    <label for="note">å‚™è€ƒï¼ˆä»»æ„ï¼‰</label>
                    <textarea id="note" rows="3" placeholder="ç‰¹è¨˜äº‹é …ãŒã‚ã‚Œã°å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                </div>

                <button type="submit" class="btn btn-primary">ğŸ“‹ LINEã‚°ãƒ«ãƒ¼ãƒ—ã«æŠ•ç¨¿</button>
                <button type="button" class="btn btn-secondary" id="saveOnly">ğŸ’¾ ä¿å­˜ã®ã¿</button>
                <a href="../index.html" class="btn btn-back">æˆ»ã‚‹</a>
            </form>
        </div>
    </div>

    <script src="../js/storage.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
        document.getElementById('leaveDate').valueAsDate = new Date();

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ï¼ˆLINEã«æŠ•ç¨¿ï¼‰
        document.getElementById('compensatoryLeaveForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const leaveDate = document.getElementById('leaveDate').value;
            const workDate = document.getElementById('workDate').value;
            const note = document.getElementById('note').value;

            const data = {
                leaveDate: leaveDate,
                workDate: workDate,
                note: note,
                category: 'ä»£ä¼‘ç”³è«‹'
            };

            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            saveData(STORAGE_KEYS.ATTENDANCE, data);

            // LINEæŠ•ç¨¿ç”¨ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
            let lineText = `ã€ä»£ä¼‘ç”³è«‹ã€‘\nä»£ä¼‘å–å¾—æ—¥: ${formatDate(leaveDate)}\nä¼‘æ—¥å‡ºå‹¤æ—¥: ${formatDate(workDate)}`;

            if (note) {
                lineText += `\nå‚™è€ƒ: ${note}`;
            }

            // LINEã«ã‚³ãƒ”ãƒ¼ã—ã¦é–‹ã
            copyToLineAndOpen(lineText);

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            setTimeout(() => {
                this.reset();
                document.getElementById('leaveDate').valueAsDate = new Date();
            }, 1000);
        });

        // ä¿å­˜ã®ã¿
        document.getElementById('saveOnly').addEventListener('click', function () {
            const leaveDate = document.getElementById('leaveDate').value;
            const workDate = document.getElementById('workDate').value;
            const note = document.getElementById('note').value;

            if (!leaveDate || !workDate) {
                alert('æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const data = {
                leaveDate: leaveDate,
                workDate: workDate,
                note: note,
                category: 'ä»£ä¼‘ç”³è«‹'
            };

            saveData(STORAGE_KEYS.ATTENDANCE, data);
            alert('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');

            document.getElementById('compensatoryLeaveForm').reset();
            document.getElementById('leaveDate').valueAsDate = new Date();
        });
    </script>
</body>

</html>