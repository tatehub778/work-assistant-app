<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="container">
        <nav class="nav-bar">
            <a href="../index.html">
                <span class="back-arrow">â†</span>
                æˆ»ã‚‹
            </a>
        </nav>

        <div class="form-container">
            <h1 class="page-title">ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ</h1>

            <div class="alert alert-info">
                ğŸ’¡ ã”è‡ªåˆ†ã®åå‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚ç”³è«‹æ™‚ã«è‡ªå‹•çš„ã«è¨˜å…¥è€…ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚
            </div>

            <form id="userSelectForm">
                <div class="form-group">
                    <label for="userName">ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼</label>
                    <select id="userName" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                    </select>
                </div>

                <button type="submit" class="btn btn-primary">âœ… ç¢ºå®šã™ã‚‹</button>
            </form>

            <div class="mt-20">
                <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆç®¡ç†</h3>

                <div class="form-group">
                    <label for="newUserName">æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ </label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newUserName" placeholder="ä¾‹: ç”°ä¸­å¤ªéƒ" style="flex: 1;">
                        <button type="button" class="btn btn-secondary" id="addUserBtn"
                            style="width: auto; padding: 15px 30px;">è¿½åŠ </button>
                    </div>
                </div>

                <div id="userList" class="mt-20">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script src="../js/storage.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆ
        const DEFAULT_USERS = [
            'ç”°ä¸­å¤ªéƒ',
            'ä½è—¤èŠ±å­',
            'éˆ´æœ¨ä¸€éƒ',
            'é«˜æ©‹æ¬¡éƒ',
            'æ¸¡è¾ºä¸‰éƒ'
        ];

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’å–å¾—ï¼ˆåˆå›ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
        function getUserList() {
            let users = JSON.parse(localStorage.getItem('user_list') || '[]');
            if (users.length === 0) {
                users = DEFAULT_USERS;
                localStorage.setItem('user_list', JSON.stringify(users));
            }
            return users;
        }

        // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
        function getCurrentUser() {
            return localStorage.getItem('current_user') || '';
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’æç”»
        function renderUserList() {
            const users = getUserList();
            const currentUser = getCurrentUser();

            // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«è¿½åŠ 
            const select = document.getElementById('userName');
            select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user;
                option.textContent = user;
                if (user === currentUser) {
                    option.selected = true;
                }
                select.appendChild(option);
            });

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆè¡¨ç¤º
            const listDiv = document.getElementById('userList');
            listDiv.innerHTML = '<h4>ç™»éŒ²æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼</h4>';
            const ul = document.createElement('ul');
            ul.style.listStyle = 'none';
            ul.style.padding = '0';

            users.forEach((user, index) => {
                const li = document.createElement('li');
                li.style.padding = '10px';
                li.style.background = '#f8f9fa';
                li.style.marginBottom = '5px';
                li.style.borderRadius = '5px';
                li.style.display = 'flex';
                li.style.justifyContent = 'space-between';
                li.style.alignItems = 'center';

                const nameSpan = document.createElement('span');
                nameSpan.textContent = user;
                if (user === currentUser) {
                    nameSpan.textContent += ' (ç¾åœ¨é¸æŠä¸­)';
                    nameSpan.style.fontWeight = 'bold';
                    nameSpan.style.color = '#4A90E2';
                }

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'å‰Šé™¤';
                deleteBtn.className = 'btn btn-back';
                deleteBtn.style.width = 'auto';
                deleteBtn.style.padding = '5px 15px';
                deleteBtn.style.marginBottom = '0';
                deleteBtn.onclick = () => deleteUser(index);

                li.appendChild(nameSpan);
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å‰Šé™¤ä¸å¯
                if (users.length > 1) {
                    li.appendChild(deleteBtn);
                }

                ul.appendChild(li);
            });

            listDiv.appendChild(ul);
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ 
        document.getElementById('addUserBtn').addEventListener('click', function () {
            const newUserName = document.getElementById('newUserName').value.trim();

            if (!newUserName) {
                alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const users = getUserList();

            if (users.includes(newUserName)) {
                alert('ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
                return;
            }

            users.push(newUserName);
            localStorage.setItem('user_list', JSON.stringify(users));

            document.getElementById('newUserName').value = '';
            renderUserList();
            alert('âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
        });

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤
        function deleteUser(index) {
            const users = getUserList();
            const currentUser = getCurrentUser();

            if (users.length <= 1) {
                alert('æœ€å¾Œã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å‰Šé™¤ã§ãã¾ã›ã‚“');
                return;
            }

            const userName = users[index];

            if (userName === currentUser) {
                if (!confirm('ç¾åœ¨é¸æŠä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã™ã€‚å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå‰Šé™¤å¾Œã¯å†åº¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼‰')) {
                    return;
                }
                localStorage.removeItem('current_user');
            }

            if (confirm(`ã€Œ${userName}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                users.splice(index, 1);
                localStorage.setItem('user_list', JSON.stringify(users));
                renderUserList();
                alert('âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
        document.getElementById('userSelectForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const userName = document.getElementById('userName').value;

            if (!userName) {
                alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            localStorage.setItem('current_user', userName);
            alert(`âœ… ã€Œ${userName}ã€ã¨ã—ã¦æ“ä½œã—ã¾ã™`);

            // ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹
            setTimeout(() => {
                window.location.href = '../index.html';
            }, 500);
        });

        // åˆæœŸæç”»
        renderUserList();
    </script>
</body>

</html>