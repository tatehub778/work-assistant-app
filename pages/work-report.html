<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½œæ¥­å ±å‘Š</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="container">
        <nav class="nav-bar">
            <a href="../index.html">
                <span class="back-arrow">â†</span>
                æˆ»ã‚‹
            </a>
        </nav>

        <div class="form-container">
            <h1 class="page-title">ğŸ“ ä½œæ¥­å ±å‘Š</h1>

            <div class="alert alert-info">
                ğŸ’¡ ä½œæ¥­æƒ…å ±ã‚’å…¥åŠ›å¾Œã€iPadã§å ±å‘Šæ›¸PDF ã«è¨˜å…¥ã—ã¦LINEã«æŠ•ç¨¿ã—ã¦ãã ã•ã„
            </div>

            <form id="workReportForm">
                <div class="form-group">
                    <label for="workDate">ä½œæ¥­æ—¥</label>
                    <input type="date" id="workDate" required>
                </div>

                <div class="form-group">
                    <label for="siteName">ç¾å ´å</label>
                    <input type="text" id="siteName" placeholder="ä¾‹: â—‹â—‹ãƒãƒ³ã‚·ãƒ§ãƒ³æ”¹ä¿®å·¥äº‹" required>
                </div>

                <div class="form-group">
                    <label for="workContent">ä½œæ¥­å†…å®¹</label>
                    <textarea id="workContent" rows="4" placeholder="ä¾‹: ã‚­ãƒƒãƒãƒ³çµ„ã¿ç«‹ã¦ã€å–ã‚Šä»˜ã‘ä½œæ¥­å®Œäº†" required></textarea>
                </div>

                <div class="form-group">
                    <label for="members">ä½œæ¥­ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆä»»æ„ï¼‰</label>
                    <input type="text" id="members" placeholder="ä¾‹: ç”°ä¸­ã€ä½è—¤ã€éˆ´æœ¨">
                </div>

                <div class="form-group">
                    <label for="notes">ãƒ¡ãƒ¢ãƒ»ç‰¹è¨˜äº‹é …ï¼ˆä»»æ„ï¼‰</label>
                    <textarea id="notes" rows="3" placeholder="å•é¡Œç‚¹ã‚„æ¬¡å›ä½œæ¥­ã®æ³¨æ„ç‚¹ãªã©"></textarea>
                </div>

                <button type="button" class="btn btn-primary" id="saveAndCopy">ğŸ’¾ ä¿å­˜ã—ã¦LINEç”¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
                <button type="button" class="btn btn-secondary" id="saveOnly">ğŸ’¾ ä¿å­˜ã®ã¿</button>
                <a href="../index.html" class="btn btn-back">æˆ»ã‚‹</a>
            </form>

            <div id="instructionBox" class="alert alert-warning" style="display: none; margin-top: 20px;">
                <h3>ğŸ“‹ æ¬¡ã®æ‰‹é †ã§ä½œæ¥­å ±å‘Šã‚’å®Œäº†ã—ã¦ãã ã•ã„</h3>
                <ol style="margin: 10px 0; padding-left: 20px;">
                    <li>iPadã§ä½œæ¥­å ±å‘Šæ›¸PDFã‚’é–‹ã</li>
                    <li>ä¸Šè¨˜ã®å†…å®¹ã‚’PDFã«è¨˜å…¥</li>
                    <li>ç¾å ´å†™çœŸã‚’æ’®å½±ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰</li>
                    <li>å®Œæˆã—ãŸPDFã¨å†™çœŸã‚’LINEã‚¢ãƒ«ãƒãƒ ã«æŠ•ç¨¿</li>
                </ol>
                <p><strong>LINEã«æŠ•ç¨¿ã™ã‚‹æ–‡ç« ã¯ã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã¾ã™ï¼</strong></p>
            </div>
        </div>
    </div>

    <script src="../js/storage.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
        document.getElementById('workDate').valueAsDate = new Date();

        // ä¿å­˜ã—ã¦LINEç”¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
        document.getElementById('saveAndCopy').addEventListener('click', function () {
            const workDate = document.getElementById('workDate').value;
            const siteName = document.getElementById('siteName').value;
            const workContent = document.getElementById('workContent').value;
            const members = document.getElementById('members').value;
            const notes = document.getElementById('notes').value;

            if (!workDate || !siteName || !workContent) {
                alert('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const data = {
                workDate: workDate,
                siteName: siteName,
                workContent: workContent,
                members: members,
                notes: notes,
                category: 'ä½œæ¥­å ±å‘Š'
            };

            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            saveData(STORAGE_KEYS.WORK_REPORTS, data);

            // LINEæŠ•ç¨¿ç”¨ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
            let lineText = `ã€ä½œæ¥­å ±å‘Šã€‘\næ—¥ä»˜: ${formatDate(workDate)}\nç¾å ´: ${siteName}\nä½œæ¥­å†…å®¹: ${workContent}`;

            if (members) {
                lineText += `\nãƒ¡ãƒ³ãƒãƒ¼: ${members}`;
            }

            if (notes) {
                lineText += `\nå‚™è€ƒ: ${notes}`;
            }

            // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(lineText)
                    .then(() => {
                        showCopySuccess();
                        document.getElementById('instructionBox').style.display = 'block';
                        document.getElementById('instructionBox').scrollIntoView({ behavior: 'smooth' });
                    })
                    .catch(err => {
                        alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    });
            } else {
                alert('ã“ã®æ©Ÿèƒ½ã¯HTTPSç’°å¢ƒã§ä½¿ç”¨ã§ãã¾ã™');
            }
        });

        // ä¿å­˜ã®ã¿
        document.getElementById('saveOnly').addEventListener('click', function () {
            const workDate = document.getElementById('workDate').value;
            const siteName = document.getElementById('siteName').value;
            const workContent = document.getElementById('workContent').value;
            const members = document.getElementById('members').value;
            const notes = document.getElementById('notes').value;

            if (!workDate || !siteName || !workContent) {
                alert('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const data = {
                workDate: workDate,
                siteName: siteName,
                workContent: workContent,
                members: members,
                notes: notes,
                category: 'ä½œæ¥­å ±å‘Š'
            };

            saveData(STORAGE_KEYS.WORK_REPORTS, data);
            alert('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');

            document.getElementById('workReportForm').reset();
            document.getElementById('workDate').valueAsDate = new Date();
            document.getElementById('instructionBox').style.display = 'none';
        });
    </script>
</body>

</html>