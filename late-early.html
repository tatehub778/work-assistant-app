<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…åˆ»/æ—©é€€ç”³å‘Š</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="container">
        <nav class="nav-bar">
            <a href="../index.html">
                <span class="back-arrow">â†</span>
                æˆ»ã‚‹
            </a>
        </nav>

        <div class="form-container">
            <h1 class="page-title">ğŸ• é…åˆ»/æ—©é€€ç”³å‘Š</h1>

            <form id="lateEarlyForm">
                <div class="form-group">
                    <label for="type">ç¨®åˆ¥</label>
                    <select id="type" required>
                        <option value="é…åˆ»">é…åˆ»</option>
                        <option value="æ—©é€€">æ—©é€€</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="date">æ—¥ä»˜</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group">
                    <label for="minutes">æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
                    <input type="number" id="minutes" min="1" placeholder="ä¾‹: 30" required>
                </div>

                <div class="form-group">
                    <label for="reason">ç†ç”±</label>
                    <select id="reason" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="äº¤é€šæ¸‹æ»">äº¤é€šæ¸‹æ»</option>
                        <option value="è»Šä¸¡æ•…éšœ">è»Šä¸¡æ•…éšœ</option>
                        <option value="é›»è»Šé…å»¶">é›»è»Šé…å»¶</option>
                        <option value="ä½“èª¿ä¸è‰¯">ä½“èª¿ä¸è‰¯</option>
                        <option value="å®¶åº­ã®äº‹æƒ…">å®¶åº­ã®äº‹æƒ…</option>
                        <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                </div>

                <div class="form-group" id="otherReasonGroup" style="display: none;">
                    <label for="otherReason">ç†ç”±ã®è©³ç´°</label>
                    <input type="text" id="otherReason" placeholder="ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                </div>

                <button type="submit" class="btn btn-primary">ğŸ“‹ LINEã‚°ãƒ«ãƒ¼ãƒ—ã«æŠ•ç¨¿</button>
                <button type="button" class="btn btn-secondary" id="saveOnly">ğŸ’¾ ä¿å­˜ã®ã¿</button>
                <a href="../index.html" class="btn btn-back">æˆ»ã‚‹</a>
            </form>
        </div>
    </div>

    <script src="../js/storage.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
        document.getElementById('date').valueAsDate = new Date();

        // ç†ç”±ãŒã€Œãã®ä»–ã€ã®å ´åˆã€è©³ç´°å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
        document.getElementById('reason').addEventListener('change', function () {
            const otherGroup = document.getElementById('otherReasonGroup');
            if (this.value === 'ãã®ä»–') {
                otherGroup.style.display = 'block';
                document.getElementById('otherReason').required = true;
            } else {
                otherGroup.style.display = 'none';
                document.getElementById('otherReason').required = false;
            }
        });

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ï¼ˆLINEã«æŠ•ç¨¿ï¼‰
        document.getElementById('lateEarlyForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const type = document.getElementById('type').value;
            const date = document.getElementById('date').value;
            const minutes = document.getElementById('minutes').value;
            let reason = document.getElementById('reason').value;

            if (reason === 'ãã®ä»–') {
                reason = document.getElementById('otherReason').value;
            }

            const data = {
                type: type,
                date: date,
                minutes: parseInt(minutes),
                reason: reason,
                category: 'é…åˆ»æ—©é€€'
            };

            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            saveData(STORAGE_KEYS.ATTENDANCE, data);

            // LINEæŠ•ç¨¿ç”¨ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
            const lineText = `ã€${type}ç”³å‘Šã€‘\næ—¥ä»˜: ${formatDate(date)}\næ™‚é–“: ${minutes}åˆ†\nç†ç”±: ${reason}`;

            // LINEã«ã‚³ãƒ”ãƒ¼ã—ã¦é–‹ã
            copyToLineAndOpen(lineText);

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            setTimeout(() => {
                this.reset();
                document.getElementById('date').valueAsDate = new Date();
            }, 1000);
        });

        // ä¿å­˜ã®ã¿
        document.getElementById('saveOnly').addEventListener('click', function () {
            const type = document.getElementById('type').value;
            const date = document.getElementById('date').value;
            const minutes = document.getElementById('minutes').value;
            let reason = document.getElementById('reason').value;

            if (reason === 'ãã®ä»–') {
                reason = document.getElementById('otherReason').value || reason;
            }

            if (!date || !minutes || !reason) {
                alert('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const data = {
                type: type,
                date: date,
                minutes: parseInt(minutes),
                reason: reason,
                category: 'é…åˆ»æ—©é€€'
            };

            saveData(STORAGE_KEYS.ATTENDANCE, data);
            alert('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');

            document.getElementById('lateEarlyForm').reset();
            document.getElementById('date').valueAsDate = new Date();
        });
    </script>
</body>

</html>