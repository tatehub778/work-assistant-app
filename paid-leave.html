<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ‰çµ¦ç”³è«‹</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="container">
        <nav class="nav-bar">
            <a href="../index.html">
                <span class="back-arrow">â†</span>
                æˆ»ã‚‹
            </a>
        </nav>

        <div class="form-container">
            <h1 class="page-title">ğŸ–ï¸ æœ‰çµ¦ç”³è«‹</h1>

            <form id="paidLeaveForm">
                <div class="form-group">
                    <label for="startDate">é–‹å§‹æ—¥</label>
                    <input type="date" id="startDate" required>
                </div>

                <div class="form-group">
                    <label for="endDate">çµ‚äº†æ—¥</label>
                    <input type="date" id="endDate" required>
                </div>

                <div class="form-group">
                    <label for="days">æ—¥æ•°</label>
                    <select id="days" required>
                        <option value="0.5">åŠæ—¥</option>
                        <option value="1">1æ—¥</option>
                        <option value="2">2æ—¥</option>
                        <option value="3">3æ—¥</option>
                        <option value="4">4æ—¥</option>
                        <option value="5">5æ—¥</option>
                        <option value="custom">ãã®ä»–</option>
                    </select>
                </div>

                <div class="form-group" id="customDaysGroup" style="display: none;">
                    <label for="customDays">æ—¥æ•°ã‚’å…¥åŠ›</label>
                    <input type="number" id="customDays" min="0.5" step="0.5" placeholder="ä¾‹: 7">
                </div>

                <div class="form-group">
                    <label for="reason">ç†ç”±</label>
                    <select id="reason" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="ç§ç”¨">ç§ç”¨</option>
                        <option value="é€šé™¢">é€šé™¢</option>
                        <option value="å®¶æ—ã®ç”¨äº‹">å®¶æ—ã®ç”¨äº‹</option>
                        <option value="å† å©šè‘¬ç¥­">å† å©šè‘¬ç¥­</option>
                        <option value="ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥">ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥</option>
                        <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                </div>

                <div class="form-group" id="otherReasonGroup" style="display: none;">
                    <label for="otherReason">ç†ç”±ã®è©³ç´°</label>
                    <input type="text" id="otherReason" placeholder="ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                </div>

                <button type="submit" class="btn btn-primary">ğŸ“‹ LINEã‚°ãƒ«ãƒ¼ãƒ—ã«æŠ•ç¨¿</button>
                <button type="button" class="btn btn-secondary" id="saveOnly">ğŸ’¾ ä¿å­˜ã®ã¿</button>
                <a href="../index.html" class="btn btn-back">æˆ»ã‚‹</a>
            </form>
        </div>
    </div>

    <script src="../js/storage.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
        const today = new Date();
        document.getElementById('startDate').valueAsDate = today;
        document.getElementById('endDate').valueAsDate = today;

        // æ—¥æ•°ãŒã€Œãã®ä»–ã€ã®å ´åˆã€ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
        document.getElementById('days').addEventListener('change', function () {
            const customGroup = document.getElementById('customDaysGroup');
            if (this.value === 'custom') {
                customGroup.style.display = 'block';
                document.getElementById('customDays').required = true;
            } else {
                customGroup.style.display = 'none';
                document.getElementById('customDays').required = false;
            }
        });

        // ç†ç”±ãŒã€Œãã®ä»–ã€ã®å ´åˆã€è©³ç´°å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
        document.getElementById('reason').addEventListener('change', function () {
            const otherGroup = document.getElementById('otherReasonGroup');
            if (this.value === 'ãã®ä»–') {
                otherGroup.style.display = 'block';
                document.getElementById('otherReason').required = true;
            } else {
                otherGroup.style.display = 'none';
                document.getElementById('otherReason').required = false;
            }
        });

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ï¼ˆLINEã«æŠ•ç¨¿ï¼‰
        document.getElementById('paidLeaveForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            let days = document.getElementById('days').value;
            let reason = document.getElementById('reason').value;

            if (days === 'custom') {
                days = document.getElementById('customDays').value;
            }

            if (reason === 'ãã®ä»–') {
                reason = document.getElementById('otherReason').value;
            }

            const data = {
                startDate: startDate,
                endDate: endDate,
                days: parseFloat(days),
                reason: reason,
                category: 'æœ‰çµ¦ç”³è«‹'
            };

            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            saveData(STORAGE_KEYS.ATTENDANCE, data);

            // LINEæŠ•ç¨¿ç”¨ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
            let lineText = `ã€æœ‰çµ¦ç”³è«‹ã€‘\n`;
            if (startDate === endDate) {
                lineText += `æ—¥ä»˜: ${formatDate(startDate)}\n`;
            } else {
                lineText += `æœŸé–“: ${formatDate(startDate)} ã€œ ${formatDate(endDate)}\n`;
            }
            lineText += `æ—¥æ•°: ${days}æ—¥\nç†ç”±: ${reason}`;

            // LINEã«ã‚³ãƒ”ãƒ¼ã—ã¦é–‹ã
            copyToLineAndOpen(lineText);

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            setTimeout(() => {
                this.reset();
                const today = new Date();
                document.getElementById('startDate').valueAsDate = today;
                document.getElementById('endDate').valueAsDate = today;
            }, 1000);
        });

        // ä¿å­˜ã®ã¿
        document.getElementById('saveOnly').addEventListener('click', function () {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            let days = document.getElementById('days').value;
            let reason = document.getElementById('reason').value;

            if (days === 'custom') {
                days = document.getElementById('customDays').value || days;
            }

            if (reason === 'ãã®ä»–') {
                reason = document.getElementById('otherReason').value || reason;
            }

            if (!startDate || !endDate || !days || !reason) {
                alert('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const data = {
                startDate: startDate,
                endDate: endDate,
                days: parseFloat(days),
                reason: reason,
                category: 'æœ‰çµ¦ç”³è«‹'
            };

            saveData(STORAGE_KEYS.ATTENDANCE, data);
            alert('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');

            document.getElementById('paidLeaveForm').reset();
            const today = new Date();
            document.getElementById('startDate').valueAsDate = today;
            document.getElementById('endDate').valueAsDate = today;
        });
    </script>
</body>

</html>